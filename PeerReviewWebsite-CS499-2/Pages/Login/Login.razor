@page "/"
@using PeerReviewWebsite.Classes.Data.Login
@inject NavigationManager UriHelper
@inherits OwningComponentBase<UserService>

<title>Login</title>

<body>
    <h1> Welcome to Online Peer Review! </h1>
    <form action="">
        <div>
            <h1> Login </h1>
        </div>

        <div>
            <!-- Add the Username & Password textfields and interative buttons-->
            <input type="email" placeholder="Email" id="email" @bind-value=@email required><br><br>
            <input type="password" placeholder="Password" id="password" @bind-value=@password required><br><br>

            <!--Error Message: only appears when the password input does not match-->
            <label id="pswordlabel" for="password" hidden="@(!ShowMessage)">ERROR: Email or Password entered incorrectly</label>
            <br />
            

            <!-- Don't use type="submit"! it breaks things!-->
            <button type="button" class="btn btn-primary" @onclick="LogInUser">Login</button><br>
            <p>Don't have an account?  <NavLink class="nav-link" href="register">Register</NavLink></p>
        </div>
    </form>
</body>

@code {

    public string email = "";
    private string password = "";
    bool ShowMessage { get; set; } = false; 

    /// <summary>
    /// Gets the user, if it exists, then logs them in
    /// </summary>
    private async Task LogInUser() {
        User user = await Service.GetUserAsync(email);
        if (user is null || user.Password != password) {
            Console.WriteLine($"Could not find user with the given email: {email} or password was incorrect");
            ShowMessage = true;
            return;
        }

        Console.WriteLine("Found user!");
        ShowMessage = false;
        PrintInput();
        UriHelper.NavigateTo($"/profile/{email}");
    }

    /// <summary>
    /// Checking that input is being properly grabbed
    /// </summary>
    private void PrintInput()
    {
        Console.WriteLine("Email entered was " + email);
        Console.WriteLine("Password entered was " + password);
    }

}
